CREATE TABLE AntithesisEvent (
    ID                     INTEGER PRIMARY KEY AUTOINCREMENT,
    EventType              TEXT    NOT NULL,
    SeverityScore          REAL    NOT NULL,
    Description            TEXT    NOT NULL,
    Timestamp              TEXT    NOT NULL,
    TriggeredByMiuStateID  INTEGER,
    TriggeredBySearchID    INTEGER,
    RelatedPatternIDs_SCSV TEXT,
    IsResolved             INTEGER NOT NULL
                                   DEFAULT 0,
    ResolutionTimestamp    TEXT,
    ResolutionDetails      TEXT,
    GeneratedRuleID        INTEGER
);

CREATE TABLE ExplorationAnomalies (
    Id                   INTEGER PRIMARY KEY AUTOINCREMENT,
    Type                 INTEGER NOT NULL,
    RuleId               INTEGER,
    ContextPatternHash   INTEGER,
    ContextPatternSample TEXT,
    Count                INTEGER NOT NULL,
    AverageValue         REAL    NOT NULL,
    AverageDepth         REAL    NOT NULL,
    LastDetected         TEXT    NOT NULL,
    Description          TEXT    NOT NULL,
    IsNewCategory        INTEGER NOT NULL,
    CreatedDate          TEXT    NOT NULL,
    UNIQUE (
        Type,
        RuleId,
        ContextPatternHash
    )
);

CREATE TABLE Learning_RuleStatistics (
    RuleID             INTEGER PRIMARY KEY,
    ApplicationCount   INTEGER NOT NULL
                               DEFAULT 0,
    SuccessfulCount    INTEGER NOT NULL
                               DEFAULT 0,
    EffectivenessScore REAL    NOT NULL
                               DEFAULT 0.0,
    LastUpdated        TEXT    NOT NULL,
    LastSearchID       INTEGER
);

CREATE TABLE Learning_TransitionStatistics (
    ParentStringCompressed TEXT    NOT NULL,
    AppliedRuleID          INTEGER NOT NULL,
    ApplicationCount       INTEGER NOT NULL
                                   DEFAULT 0,
    SuccessfulCount        INTEGER NOT NULL
                                   DEFAULT 0,
    LastUpdated            TEXT    NOT NULL,
    PRIMARY KEY (
        ParentStringCompressed,
        AppliedRuleID
    ),
    FOREIGN KEY (
        AppliedRuleID
    )
    REFERENCES RegoleMIU (ID) 
);

CREATE TABLE LlmArchitectureLog (
    ID                      INTEGER PRIMARY KEY AUTOINCREMENT,
    VersionNumber           TEXT    NOT NULL
                                    UNIQUE,
    Description             TEXT    NOT NULL,
    ModificationTimestamp   TEXT    NOT NULL,
    TriggeredByAntithesisID INTEGER,
    PerformanceMetrics_SCSV TEXT
);

CREATE TABLE LlmSemanticInterpretation (
    ID                     INTEGER PRIMARY KEY AUTOINCREMENT,
    EntityID               INTEGER NOT NULL,
    EntityType             TEXT    NOT NULL,
    SemanticText           TEXT    NOT NULL,
    ConfidenceScore        REAL,
    Timestamp              TEXT    NOT NULL,
    LlmArchitectureVersion TEXT    NOT NULL,
    HumanFeedback_SCSV     TEXT,
    RelevanceScore         REAL    NOT NULL
                                   DEFAULT 1.0
);

CREATE TABLE MIU_Actions (
    ID                 INTEGER PRIMARY KEY AUTOINCREMENT,
    OperationID        INTEGER,
    OperationType      TEXT    NOT NULL,
    OperationData      TEXT,
    OperationTime_Int  INTEGER,
    OperationTime_Text TEXT
);

CREATE TABLE MIU_Paths (
    PathStepID    INTEGER PRIMARY KEY AUTOINCREMENT,
    SearchID      INTEGER NOT NULL,
    StepNumber    INTEGER NOT NULL,
    StateID       INTEGER NOT NULL,
    ParentStateID INTEGER,
    AppliedRuleID INTEGER,
    IsTarget      BOOLEAN NOT NULL,
    IsSuccess     BOOLEAN NOT NULL,
    Depth         INTEGER NOT NULL,
    FOREIGN KEY (
        SearchID
    )
    REFERENCES MIU_Searches (SearchID),
    FOREIGN KEY (
        AppliedRuleID
    )
    REFERENCES RegoleMIU (ID) 
);

CREATE TABLE MIU_RuleApplications (
    ApplicationID INTEGER PRIMARY KEY AUTOINCREMENT,
    SearchID      INTEGER NOT NULL,
    ParentStateID INTEGER NOT NULL,
    NewStateID    INTEGER NOT NULL,
    AppliedRuleID INTEGER NOT NULL,
    CurrentDepth  INTEGER NOT NULL,
    Timestamp     TEXT    NOT NULL,
    FOREIGN KEY (
        SearchID
    )
    REFERENCES MIU_Searches (SearchID),
    FOREIGN KEY (
        AppliedRuleID
    )
    REFERENCES RegoleMIU (ID) 
);

CREATE TABLE MIU_Searches (
    SearchID            INTEGER  PRIMARY KEY AUTOINCREMENT,
    InitialString       TEXT     NOT NULL,
    TargetString        TEXT,
    SearchAlgorithm     TEXT,
    StartTime           DATETIME,
    EndTime             DATETIME,
    Outcome             TEXT,
    StepsTaken          INTEGER,
    MaxDepth            INTEGER,
    NodesExplored       INTEGER,
    ElapsedMilliseconds REAL,
    TargetUcount        INTEGER,
    TargetIcount        INTEGER,
    InitialUcount       INTEGER,
    InitialIcount       INTEGER,
    TargetStringLength  INTEGER,
    InitialStringLength INTEGER
);

CREATE TABLE MIU_States (
    StateID            INTEGER PRIMARY KEY AUTOINCREMENT,
    CurrentString      TEXT    UNIQUE
                               NOT NULL,
    StringLength       INTEGER,
    DeflateString      TEXT,
    Hash               TEXT,
    DiscoveryTime_Int  INTEGER,
    DiscoveryTime_Text TEXT,
    SeedingType        INTEGER
);

CREATE TABLE MIU_States_History (
    Id                         INTEGER PRIMARY KEY AUTOINCREMENT,
    MIUString                  TEXT    NOT NULL,
    Hash                       TEXT    NOT NULL
                                       UNIQUE,
    FirstDiscoveredByRuleId    INTEGER NOT NULL,
    Depth                      INTEGER NOT NULL,
    TimesFound                 INTEGER NOT NULL
                                       DEFAULT 1,
    Timestamp                  TEXT    NOT NULL,
    UsageCount                 INTEGER,
    DetectedPatternHashes_SCSV TEXT
);

CREATE TABLE MIUParameterConfigurator (
    ID              INTEGER PRIMARY KEY ON CONFLICT ROLLBACK AUTOINCREMENT
                            UNIQUE ON CONFLICT ROLLBACK
                            NOT NULL ON CONFLICT ROLLBACK,
    NomeParametro   TEXT    UNIQUE ON CONFLICT ROLLBACK
                            NOT NULL ON CONFLICT ROLLBACK,
    ValoreParametro TEXT    NOT NULL,
    Descrizione     TEXT
);

CREATE TABLE MiuPattern (
    ID                     INTEGER PRIMARY KEY AUTOINCREMENT,
    PatternString          TEXT    NOT NULL
                                   UNIQUE,
    PatternHash            TEXT    NOT NULL
                                   UNIQUE,
    PatternType            TEXT    NOT NULL,
    ComplexityScore        REAL    NOT NULL
                                   DEFAULT 0.0,
    CreationTimestamp      TEXT    NOT NULL,
    SourceAntithesisId     INTEGER,
    Description            TEXT,
    IsPrincipal            INTEGER NOT NULL
                                   DEFAULT 1,
    DerivedFromPatternID   INTEGER,
    DerivationRule         TEXT,
    ParentPatternID        INTEGER,
    RelatedPatternIDs_SCSV TEXT
);

CREATE TABLE PatternStatistics (
    ID                        INTEGER PRIMARY KEY AUTOINCREMENT,
    MiuPatternID              INTEGER NOT NULL
                                      UNIQUE,
    DetectionCount            INTEGER NOT NULL
                                      DEFAULT 0,
    AssociatedAntithesisCount INTEGER NOT NULL
                                      DEFAULT 0,
    AssociatedSolutionCount   INTEGER NOT NULL
                                      DEFAULT 0,
    CurrentEpistemicPressure  REAL    NOT NULL
                                      DEFAULT 0.0,
    LastDetectionTimestamp    TEXT    NOT NULL,
    LastUpdateTimestamp       TEXT    NOT NULL
);

CREATE TABLE RegoleMIU (
    ID                   INTEGER    PRIMARY KEY ON CONFLICT ROLLBACK AUTOINCREMENT
                                    UNIQUE ON CONFLICT ROLLBACK
                                    NOT NULL ON CONFLICT ROLLBACK,
    Nome                 TEXT (16)  NOT NULL ON CONFLICT ROLLBACK,
    Pattern              TEXT (16)  UNIQUE ON CONFLICT ROLLBACK
                                    NOT NULL ON CONFLICT ROLLBACK,
    Sostituzione         TEXT (12)  UNIQUE ON CONFLICT ROLLBACK
                                    NOT NULL ON CONFLICT ROLLBACK,
    Descrizione          TEXT (512),
    StimaProfonditaMedia REAL
);

CREATE TABLE RuleTaxonomy (
    TaxonomyID    INTEGER PRIMARY KEY AUTOINCREMENT,
    Name          TEXT    NOT NULL,
    Description   TEXT,
    LastGenerated TEXT    NOT NULL
);
